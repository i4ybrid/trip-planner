# Dockerfile.socket - Socket.io Server
FROM node:20-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY socket/package*.json ./socket/ 2>/dev/null || true

# Install dependencies
RUN npm ci --legacy-peer-deps
RUN npm install -g prisma

# Copy source
COPY . .

# Generate Prisma client
RUN npx prisma generate

# Build TypeScript
RUN npx tsc --project socket/tsconfig.json

EXPOSE 3001

CMD ["node", "socket/dist/server.js"]
